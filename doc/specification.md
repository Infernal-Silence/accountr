# Спецификация API

[**Работа с пользователем**](#работа-с-пользователем)
- [Регистрация](#регистрация)
- [Получение информации о пользователе](#получение-информации-о-пользователе)
- [Авторизация](#авторизация)
- [Выход из аккаунта](#выход-из-аккаунта)

[**Работа с типами операций**](#работа-с-типами-операций)
- [Получение всех типов](#получение-всех-типов)

[**Работа с операциями**](#работа-с-операциями)
- [Создание операции](#создание-операции)
- [Получние информации о операции](#получние-информации-о-операции)
- [Изменение операции](#изменение-операции)
- [Удаление операции](#удаление-операции)

[**Работа с категориями**](#работа-с-категориями)
- [Добавление категории](#добавление-категории)
- [Получение информации о категории](#получение-информации-о-категории)
- [Получение созданных категорий](#получение-созданных-категорий)
- [Изменение категории](#изменение-категории)
- [Удаление категории](#удаление-категории)

[**Работа с отчётами**](#работа-с-отчётами)
- [Получение отчёта](#получение-отчёта)
---
**?** - *необязательный парметр*

*Предполагается, что в запросе есть все обязательные параметры и их типы указаны корректно*

---
## Работа с пользователем
### Регистрация
URL: `/users/`

Метод: **POST**

Запрос:
```
{
    first_name: str,
    last_name: str,
    email: str,
    password: str
}
```
Код успешного ответа: **201**

Ответ:
```
{
    id: int,
    first_name: str,
    last_name: str,
    email: str
}
```
Примечания:
- Если такой пользователь уже был создан ранее, возвращается код ошибки 409

---
### Получение информации о пользователе
Требования: 
 - пользователь авторизован
 - пользователь может получить информацию только о себе

URL: `/user/`

Метод: **GET**

Запрос: пусто

Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    first_name: str,
    last_name: str,
    email: str
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь получает информацию только о себе

---

### Авторизация
URL: `/auth/login/`

Метод: **POST**

Запрос:
```
{
    email: str,
    password: str
}
```
Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    first_name, 
    last_name,
    email: str
}
```
Примечания:
- Если указан неверный логин или пароль, возвращает код ошибки 403

---
### Выход из аккаунта
URL: `/auth/logout/`

Метод: **POST**

Запрос: **пустой**

Код успешного ответа: **200**

Ответ: **пустой**

Примечания:
- Если пользователь не был авторизован, тоже возвращает код 200

----
[К оглавлению](#спецификация-api)

----
## Работа с типами операций
### Получение всех типов
URL: `/types/`

Метод: **GET**

Запрос: **пустой**

Код успешного ответа: **200**

Ответ:
```
[
    {
        id: int,
        name: str
    }
]
```

Примечания:
- Если пользователь не был авторизован, тоже возвращает код ошибки 401

----
### Получение типа
URL: `/types/<id>`

Метод: **GET**

Запрос: **пустой**

Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    name: str
}
```

Примечания:
- Если пользователь не был авторизован, тоже возвращает код ошибки 401

----
[К оглавлению](#спецификация-api)


## Работа с операциями
### Создание операции
Требования: 
 - пользователь авторизован

URL:  `/operations/`

Метод: **POST**

Запрос:
```
{
    user_id: int,
    type_id: int,
    category_id: int?,
    amount: float?,
    operation_date: datetime,
    description: str?    
}
```
Код успешного ответа: **201**

Ответ:
```
{
    id: int,
    user_id: int,
    type_id: int,
    category_id: int,
    amount: float,
    operation_date: date,
    created_date: date,
    description: str
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если не указано описание (description), то всё равно вернуть это поле (будет равно пустой строке)
- Поле created_date не указывается в запросе, в него записывается дата создания записи в базе данных

----
### Получние информации о операции
Требования: 
 - пользователь авторизован
 - пользователь получает информацию только про свою операцию

URL: `/operations/<id>`

Метод: **GET**

Запрос: пусто

Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    user_id: int,
    type_id: int,
    category_id: int,
    amount: float,
    operation_date: date,
    created_date: date,
    description: str
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается получить информацию не про свою операции, вовзращает код ошибки 403
- Если операции с данным id не существует, возвращает код ошибки 404
----

### Изменение операции
Требования: 
 - пользователь авторизован
 - пользователь обновляет только свою операцию

URL: `/operations/<id>`

Метод: **PATCH**

Запрос:
```
{
    type_id: int?,
    category_id: int?,
    amount: float?,
    operation_date: date?,
    description: str?  
}
```
Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    user_id: int,
    type_id: int,
    category_id: int,
    amount: float,
    operation_date: date,
    created_date: date,
    description: str
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается обновить не свою операции, вовзращает код ошибки 403
- Если пользователь пытается добавить операцию с несуществующим типом, возвращает код ошибки 400
- Если операции с данным id не существует, возвращает код ошибки 404
----
### Удаление операции
Требования: 
 - пользователь авторизован
 - пользователь обновляет только свою операцию

URL: `/operations/<id>`

Метод: **DELETE**

Запрос: пустой

Код успешного ответа: **200**

Ответ: пустой

Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается удалить не свою операции, вовзращает код ошибки 403
- Если операции с данным id не существует, возвращает код ошибки 404

----
[К оглавлению](#спецификация-api)

----
## Работа с категориями
### Добавление категории 
Требования:
 - пользователь авторизован

URL: `/categories/` 

Метод: **POST**

Запрос:
```
{
    name: str,
    parent_category_id: int?
}
```
Код успешного ответа: **201**

Ответ:
```
{
    id: int,
    name: str,
    user_id: int,
    parent_id: int?
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если родительской категорией указана категория, созданная не пользователем, возвращает код ошибки 400
- Если родительской категории не существует, возвращает код ошибки 400
----
### Получение информации о категории
Требования:
 - пользователь авторизован
 - пользователь получает информацию только о созданной им категории

URL: `/categories/<id>` 

Метод: **GET**

Запрос: пустой

Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    name: str,
    user_id: int,
    parent_id: int?
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается просмотреть созданную не им категорию, возвращает код ошибки 403
- Если категории с данным id не существует, возвращает код ошибки 404
----
### Получение созданных категорий
Требования:
 - пользователь авторизован
 - пользователь получает информацию только о созданной им категориях

URL: `/categories/` 

Метод: **GET**

Запрос: пустой

Код успешного ответа: **200**

Ответ:
```
[
    {
        id: int,
        name: str,
        user_id: int,
        parent_id: int?
    }
]
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если у пользователя не было создано ни одной категории, должен возвращать код 200 и ответ:
```
[]
```
----

### Изменение категории
Требования:
 - пользователь авторизован
 - пользователь изменяет только созданную им категорию

URL: `/categories/<id>` 

Метод: **PATCH**

Запрос:
```
{
    name: str?,
    parent_id: int?
}
```
Код успешного ответа: **200**

Ответ:
```
{
    id: int,
    name: str,
    user_id: int,
    parent_id: int?
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается изменить созданную не им категорию, возвращает код ошибки 403
- Если родительской категорией указана категория, созданная не пользователем, возвращает код ошибки 400
- Если родительской категории не существует, возвращает код ошибки 400
- Если категории с данным id не существует, возвращает код ошибки 404

----
### Удаление категории
Требования:
 - пользователь авторизован
 - пользователь удаляет только созданную им категорию

URL: `/categories/<id>` 

Метод: **DELETE**

Запрос: пустой

Код успешного ответа: **200**

Ответ: пустой

Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается удалить созданную не им категорию, возвращает код ошибки 403
- Если категории с данным id не существует, возвращает код ошибки 404

----
[К оглавлению](#спецификация-api)

----

## Работа с отчётами
### Получение отчёта
Требования:
 - пользователь авторизован
 - список операций в ответе отсортирован по возрастанию даты операции

URL:
- `/users/<user_id>/report/
- `/report/`

Метод: **GET**

Запрос: пустой

Query string:
```
category_id: int?,
page_size: int?,
page: int?,
period: str?,
start_date: date?,
end_date: date?
```

Код успешного ответа: **200**

Ответ:
```
{
    total_amount: float,
    operations:
    [   
        {
            id: int,
            operation_date: date,
            created_date: date,
            amount: float,
            description: str,
            type_name: str,
            categories: 
                [
                    {
                        id: int,
                        name: str,
                        parent_id: int?
                    }
                ]
        }
    ]
    total_pages: int?,
    total_items: int?
}
```
Примечания:
- Если пользователь не был авторизован, возвращает код ошибки 401
- Если пользователь пытается получить отчёт о другом пользователе (user_id из ссылки не соответсвует id авторизированного пользователя), возвращает код ошибки 403
- Если за указанный период не было ни одной операции, должен вернуть следущий ответ:
```
{
    total_amount: 0,
    operations: []
}
```

----
----
[К оглавлению](#спецификация-api)

